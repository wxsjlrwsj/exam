import{v as Z,r as u,a as ee,W as te,q as ae,c as le,d as p,b as t,w as l,e as s,t as T,X as oe,o as B,j as i,f as V,a4 as ne,S as se,$ as re,h as D,n as ue,a5 as ie,a0 as de,a2 as U}from"./index-DOcvSAvK.js";import{s as m}from"./request-3uTHAmsp.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-ngrFHoWO.js";const ce={class:"page-container"},me={class:"header"},ge={class:"header-left"},_e={style:{"margin-left":"10px",display:"inline-block"}},fe={class:"actions"},ve={class:"filter-container",style:{"margin-bottom":"20px"}},ye={class:"pagination-container"},he={class:"dialog-footer"},we={__name:"RoleUsers",setup(be){const c=Z().params.roleId,$=u(""),v=u(!1),y=u([]),h=u(0),g=u(!1),w=u(""),S=u(null),b=u([]),N=u([]),k=u([]),I=u(null),n=ee({pageNum:1,pageSize:10,username:"",realName:""}),_=async()=>{v.value=!0;try{const a=await m.get(`/system/role/${c}/allocated-users`,{params:n});y.value=a.data?.list||[],h.value=a.data?.total||0}catch(a){console.error(a),y.value=[],h.value=0}finally{v.value=!1}},A=async()=>{try{const a=await m.get(`/system/role/${c}`);$.value=a.data?.roleName||c}catch{}},f=()=>{n.pageNum=1,_()},E=()=>{n.username="",n.realName="",f()},K=a=>{de.confirm(`确认取消用户 "${a.username}" 的授权吗？`,"警告",{type:"warning"}).then(async()=>{try{await m.delete("/system/role/users",{data:{roleId:c,userIds:[a.id]}}),U.success("取消授权成功"),_()}catch{}})},L=async()=>{try{const a=await m.get("/org/tree");b.value=a.data||[]}catch(a){console.error(a)}},M=()=>{g.value=!0,b.value.length===0&&L(),R()},R=async()=>{try{const a=await m.get(`/system/role/${c}/unallocated-users`,{params:{username:n.username,realName:n.realName,orgId:I.value}});N.value=a.data?.list||[]}catch{N.value=[]}},P=a=>{k.value=a},q=async()=>{if(k.value.length===0){U.warning("请选择用户");return}const a=k.value.map(e=>e.id);try{await m.post("/system/role/users",{roleId:c,userIds:a}),U.success(`成功添加 ${a.length} 名用户`),g.value=!1,_()}catch{}};te(w,a=>{S.value.filter(a)});const Q=(a,e)=>a?e.name.includes(a):!0,j=a=>{I.value=a.id,R()};return ae(()=>{_(),A()}),(a,e)=>{const x=s("el-icon"),d=s("el-button"),C=s("el-input"),r=s("el-table-column"),W=s("el-tag"),z=s("el-table"),X=s("el-pagination"),F=s("el-card"),G=s("el-tree"),O=s("el-col"),H=s("el-row"),J=s("el-dialog"),Y=oe("loading");return B(),le("div",ce,[p("div",me,[p("div",ge,[t(d,{link:"",onClick:e[0]||(e[0]=o=>a.$router.push({name:"AdminPermission"}))},{default:l(()=>[t(x,null,{default:l(()=>[t(V(ne))]),_:1}),e[8]||(e[8]=i(" 返回 ",-1))]),_:1}),p("h2",_e,"角色成员管理 - "+T($.value),1)]),p("div",fe,[t(d,{type:"primary",onClick:M},{default:l(()=>[t(x,null,{default:l(()=>[t(V(se))]),_:1}),e[9]||(e[9]=i(" 添加成员 ",-1))]),_:1})])]),t(F,null,{default:l(()=>[p("div",ve,[t(C,{modelValue:n.username,"onUpdate:modelValue":e[1]||(e[1]=o=>n.username=o),placeholder:"请输入用户名",style:{width:"200px","margin-right":"10px"},onKeyup:D(f,["enter"])},null,8,["modelValue"]),t(C,{modelValue:n.realName,"onUpdate:modelValue":e[2]||(e[2]=o=>n.realName=o),placeholder:"请输入真实姓名",style:{width:"200px","margin-right":"10px"},onKeyup:D(f,["enter"])},null,8,["modelValue"]),t(d,{type:"primary",onClick:f},{default:l(()=>[...e[10]||(e[10]=[i("搜索",-1)])]),_:1}),t(d,{onClick:E},{default:l(()=>[...e[11]||(e[11]=[i("重置",-1)])]),_:1})]),re((B(),ue(z,{data:y.value,border:"",style:{width:"100%"}},{default:l(()=>[t(r,{prop:"id",label:"用户ID",width:"100"}),t(r,{prop:"username",label:"用户名"}),t(r,{prop:"realName",label:"真实姓名"}),t(r,{prop:"orgName",label:"所属部门"}),t(r,{prop:"phonenumber",label:"手机号码",width:"150"}),t(r,{prop:"status",label:"状态",width:"100"},{default:l(o=>[t(W,{type:o.row.status==="1"?"success":"danger"},{default:l(()=>[i(T(o.row.status==="1"?"正常":"停用"),1)]),_:2},1032,["type"])]),_:1}),t(r,{label:"操作",width:"150",align:"center"},{default:l(o=>[t(d,{link:"",type:"danger",onClick:ke=>K(o.row)},{default:l(()=>[t(x,null,{default:l(()=>[t(V(ie))]),_:1}),e[12]||(e[12]=i(" 取消授权 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,v.value]]),p("div",ye,[t(X,{"current-page":n.pageNum,"onUpdate:currentPage":e[3]||(e[3]=o=>n.pageNum=o),"page-size":n.pageSize,"onUpdate:pageSize":e[4]||(e[4]=o=>n.pageSize=o),total:h.value,layout:"total, prev, pager, next",onCurrentChange:_},null,8,["current-page","page-size","total"])])]),_:1}),t(J,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=o=>g.value=o),title:"选择用户",width:"800px"},{footer:l(()=>[p("span",he,[t(d,{onClick:e[6]||(e[6]=o=>g.value=!1)},{default:l(()=>[...e[13]||(e[13]=[i("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:q},{default:l(()=>[...e[14]||(e[14]=[i("确定",-1)])]),_:1})])]),default:l(()=>[t(H,{gutter:20},{default:l(()=>[t(O,{span:6},{default:l(()=>[t(C,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=o=>w.value=o),placeholder:"请输入部门名称",style:{"margin-bottom":"10px"}},null,8,["modelValue"]),t(G,{ref_key:"orgTreeRef",ref:S,data:b.value,props:{label:"name",children:"children"},"filter-node-method":Q,"default-expand-all":"","highlight-current":"",onNodeClick:j},null,8,["data"])]),_:1}),t(O,{span:18},{default:l(()=>[t(z,{ref:"multipleTableRef",data:N.value,onSelectionChange:P,height:"400px"},{default:l(()=>[t(r,{type:"selection",width:"55"}),t(r,{prop:"username",label:"用户名"}),t(r,{prop:"realName",label:"真实姓名"}),t(r,{prop:"orgName",label:"部门"})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},$e=pe(we,[["__scopeId","data-v-1f157a89"]]);export{$e as default};
