import{r as i,a as B,k as N,c as R,b as t,d as c,w as a,e as f,u as q,i as z,o as _,n as k,p as y,j as w,t as P,f as I}from"./index-DOcvSAvK.js";import{P as M}from"./ParticlesBackground-DjYnQhPs.js";import{s as T}from"./request-3uTHAmsp.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-ngrFHoWO.js";const j={class:"forgot-container"},E={class:"forgot-box"},$={class:"code-container"},A={class:"extra-actions"},D={__name:"ForgotPassword",setup(K){const b=q(),p=z("showMessage"),m=i(!1),v=i(null),o=i(1),l=i(0),s=B({account:"",code:"",newPassword:""}),h={account:[{required:!0,message:"请输入邮箱或手机号",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于 6 位",trigger:"blur"}]},x=N(()=>{switch(o.value){case 1:return"下一步";case 2:return"验证";case 3:return"重置密码";default:return"提交"}}),V=()=>{l.value=60,p("验证码已发送 (模拟: 123456)","success");const r=setInterval(()=>{l.value--,l.value<=0&&clearInterval(r)},1e3)},C=async()=>{if(!v.value)return;const r=[];o.value===1&&r.push("account"),o.value===2&&r.push("code"),o.value===3&&r.push("newPassword"),await v.value.validateField(r,async e=>{if(e){m.value=!0;try{if(o.value===1)o.value=2,V();else if(o.value===2){if(s.code!=="123456")throw new Error("验证码错误");o.value=3}else o.value===3&&(await T.post("/auth/reset-password",{username:s.account,newPassword:s.newPassword}),p("密码重置成功，请重新登录","success"),b.push("/login"))}catch(n){(o.value!==3||!n.response)&&p(n.message||"操作失败","error")}finally{m.value=!1}}})};return(r,e)=>{const n=f("el-input"),d=f("el-form-item"),g=f("el-button"),F=f("el-form");return _(),R("div",j,[t(M,{color:"rgba(255, 255, 255, 0.6)",count:80}),c("div",E,[e[5]||(e[5]=c("div",{class:"forgot-header"},[c("h1",{class:"title"},"重置密码"),c("p",{class:"subtitle"},"请输入您的注册邮箱或手机号")],-1)),t(F,{ref_key:"forgotFormRef",ref:v,model:s,rules:h,class:"forgot-form"},{default:a(()=>[t(d,{prop:"account"},{default:a(()=>[t(n,{modelValue:s.account,"onUpdate:modelValue":e[0]||(e[0]=u=>s.account=u),placeholder:"邮箱 / 手机号","prefix-icon":"Message",size:"large"},null,8,["modelValue"])]),_:1}),o.value===2?(_(),k(d,{key:0,prop:"code"},{default:a(()=>[c("div",$,[t(n,{modelValue:s.code,"onUpdate:modelValue":e[1]||(e[1]=u=>s.code=u),placeholder:"验证码","prefix-icon":"Key",size:"large"},null,8,["modelValue"]),t(g,{disabled:l.value>0,onClick:V,class:"send-btn"},{default:a(()=>[w(P(l.value>0?`${l.value}s后重试`:"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1})):y("",!0),o.value===3?(_(),k(d,{key:1,prop:"newPassword"},{default:a(()=>[t(n,{modelValue:s.newPassword,"onUpdate:modelValue":e[2]||(e[2]=u=>s.newPassword=u),type:"password",placeholder:"新密码","prefix-icon":"Lock",size:"large"},null,8,["modelValue"])]),_:1})):y("",!0),t(d,null,{default:a(()=>[t(g,{type:"primary",loading:m.value,onClick:C,class:"action-button"},{default:a(()=>[w(P(x.value),1)]),_:1},8,["loading"])]),_:1}),c("div",A,[t(g,{link:"",type:"info",onClick:e[3]||(e[3]=u=>I(b).push("/login"))},{default:a(()=>[...e[4]||(e[4]=[w("返回登录",-1)])]),_:1})])]),_:1},8,["model"])])])}}},O=U(D,[["__scopeId","data-v-a420d7ad"]]);export{O as default};
