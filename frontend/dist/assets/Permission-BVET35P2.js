import{r as u,a as ue,q as ie,c as M,d as c,b as l,w as t,e as n,u as pe,X as ce,o as x,j as d,f as me,S as fe,$ as O,n as P,t as j,a1 as _e,a2 as V,a3 as N,a0 as ve}from"./index-DOcvSAvK.js";import{s as i}from"./request-3uTHAmsp.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-ngrFHoWO.js";const ge={class:"page-container"},be={class:"header"},ke={class:"actions"},we={key:0},Ve={class:"tree-border"},he={class:"dialog-footer"},Ce={class:"tree-border"},Ke={class:"dialog-footer"},Se={__name:"Permission",setup(xe){const A=pe(),R=u(!1),$=u([]),m=u(!1),g=u(!1),h=u("add"),U=u([]),C=u([]),b=u(null),k=u(null),K=u(null),s=ue({id:void 0,roleName:"",roleKey:"",dataScope:"1",status:1,deptIds:[]}),f=u({}),L={roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleKey:[{required:!0,message:"请输入角色字符",trigger:"blur"}],dataScope:[{required:!0,message:"请选择数据权限",trigger:"change"}]},I=async()=>{R.value=!0;try{const a=await i.get("/system/role/list");$.value=a.data||[]}catch{$.value=[]}finally{R.value=!1}},H=async()=>{try{const a=await i.get("/system/menu/routes");U.value=a.data||[]}catch(a){console.error(a)}},D=async()=>{try{const a=await i.get("/org/tree");C.value=a.data||[]}catch(a){console.error(a)}},X=a=>({1:"全部数据权限",2:"自定义数据权限",3:"本部门数据权限",4:"本部门及以下数据权限",5:"仅本人数据权限"})[a]||"未知",z=async()=>{h.value="add",m.value=!0,C.value.length===0&&await D(),Object.assign(s,{id:void 0,roleName:"",roleKey:"",dataScope:"1",status:1,deptIds:[]}),N(()=>{b.value?.clearValidate(),K.value?.setCheckedKeys([])})},G=async a=>{h.value="edit",m.value=!0,C.value.length===0&&await D(),Object.assign(s,{...a,deptIds:a.deptIds||[]}),N(()=>{b.value?.clearValidate(),s.dataScope==="2"&&K.value?.setCheckedKeys(s.deptIds||[])})},J=a=>{},Q=async()=>{b.value&&await b.value.validate(async a=>{if(a){s.dataScope==="2"&&(s.deptIds=K.value.getCheckedKeys());try{h.value==="add"?(await i.post("/system/role",s),V.success("新增成功")):(await i.put("/system/role",s),V.success("修改成功")),m.value=!1,I()}catch{}}})},W=a=>{ve.confirm(`确认删除角色 "${a.roleName}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await i.delete(`/system/role/${a.id}`),V.success("删除成功"),I()}catch{}})},Y=async a=>{const e=a.status===1?0:1;try{await i.put("/system/role",{...a}),V.success(`已${a.status===1?"启用":"停用"}角色 ${a.roleName}`)}catch{a.status=e}},Z=async a=>{f.value={...a},g.value=!0,U.value.length===0&&await H();try{const _=(await i.get(`/system/menu/role/${a.id}`)).data||[];N(()=>{k.value.setCheckedKeys(_)})}catch(e){console.error(e),N(()=>{k.value?.setCheckedKeys([])})}},ee=async()=>{const a=k.value.getCheckedKeys(),e=k.value.getHalfCheckedKeys(),_=[...a,...e];try{await i.put("/system/role/auth",{roleId:f.value.id,menuIds:_}),V.success("权限分配成功"),g.value=!1}catch{}},le=a=>{A.push({name:"AdminRoleUsers",params:{roleId:a.id}})};return ie(()=>{I()}),(a,e)=>{const _=n("el-icon"),r=n("el-button"),v=n("el-table-column"),T=n("el-tag"),te=n("el-tooltip"),ae=n("el-switch"),oe=n("el-table"),se=n("el-card"),S=n("el-input"),p=n("el-form-item"),w=n("el-option"),ne=n("el-select"),B=n("el-tree"),F=n("el-radio"),de=n("el-radio-group"),q=n("el-form"),E=n("el-dialog"),re=ce("loading");return x(),M("div",ge,[c("div",be,[e[11]||(e[11]=c("h2",null,"权限管理",-1)),c("div",ke,[l(r,{type:"primary",onClick:z},{default:t(()=>[l(_,null,{default:t(()=>[l(me(fe))]),_:1}),e[10]||(e[10]=d(" 新增角色 ",-1))]),_:1})])]),l(se,{class:"role-list-card"},{default:t(()=>[O((x(),P(oe,{data:$.value,style:{width:"100%"}},{default:t(()=>[l(v,{prop:"id",label:"ID",width:"80"}),l(v,{prop:"roleName",label:"角色名称",width:"150"}),l(v,{prop:"roleKey",label:"角色字符",width:"150"},{default:t(o=>[l(T,null,{default:t(()=>[d(j(o.row.roleKey),1)]),_:2},1024)]),_:1}),l(v,{prop:"dataScope",label:"数据权限范围",width:"250"},{default:t(o=>[o.row.dataScope==="2"?(x(),M("div",we,[l(T,{type:"warning",effect:"plain"},{default:t(()=>[...e[12]||(e[12]=[d("自定义数据权限",-1)])]),_:1}),l(te,{content:"点击查看具体部门",placement:"top"},{default:t(()=>[l(r,{type:"primary",link:"",icon:"Search",style:{"margin-left":"5px"}})]),_:1})])):(x(),P(T,{key:1,type:"info",effect:"plain"},{default:t(()=>[d(j(X(o.row.dataScope)),1)]),_:2},1024))]),_:1}),l(v,{prop:"status",label:"状态",width:"100"},{default:t(o=>[l(ae,{modelValue:o.row.status,"onUpdate:modelValue":y=>o.row.status=y,"active-value":1,"inactive-value":0,onChange:y=>Y(o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(v,{label:"操作","min-width":"250"},{default:t(o=>[l(r,{link:"",type:"primary",onClick:y=>G(o.row)},{default:t(()=>[...e[13]||(e[13]=[d("编辑",-1)])]),_:1},8,["onClick"]),l(r,{link:"",type:"primary",onClick:y=>Z(o.row)},{default:t(()=>[...e[14]||(e[14]=[d("菜单权限",-1)])]),_:1},8,["onClick"]),l(r,{link:"",type:"primary",onClick:y=>le(o.row)},{default:t(()=>[...e[15]||(e[15]=[d("分配用户",-1)])]),_:1},8,["onClick"]),l(r,{link:"",type:"danger",onClick:y=>W(o.row)},{default:t(()=>[...e[16]||(e[16]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[re,R.value]])]),_:1}),l(E,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=o=>m.value=o),title:h.value==="add"?"新增角色":"编辑角色",width:"600px"},{footer:t(()=>[c("span",he,[l(r,{onClick:e[4]||(e[4]=o=>m.value=!1)},{default:t(()=>[...e[19]||(e[19]=[d("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:Q},{default:t(()=>[...e[20]||(e[20]=[d("确定",-1)])]),_:1})])]),default:t(()=>[l(q,{model:s,rules:L,ref_key:"roleFormRef",ref:b,"label-width":"100px"},{default:t(()=>[l(p,{label:"角色名称",prop:"roleName"},{default:t(()=>[l(S,{modelValue:s.roleName,"onUpdate:modelValue":e[0]||(e[0]=o=>s.roleName=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),l(p,{label:"角色字符",prop:"roleKey"},{default:t(()=>[l(S,{modelValue:s.roleKey,"onUpdate:modelValue":e[1]||(e[1]=o=>s.roleKey=o),placeholder:"请输入角色字符"},null,8,["modelValue"])]),_:1}),l(p,{label:"数据权限",prop:"dataScope"},{default:t(()=>[l(ne,{modelValue:s.dataScope,"onUpdate:modelValue":e[2]||(e[2]=o=>s.dataScope=o),placeholder:"请选择数据权限范围",onChange:J},{default:t(()=>[l(w,{label:"全部数据权限",value:"1"}),l(w,{label:"自定义数据权限",value:"2"}),l(w,{label:"本部门数据权限",value:"3"}),l(w,{label:"本部门及以下数据权限",value:"4"}),l(w,{label:"仅本人数据权限",value:"5"})]),_:1},8,["modelValue"])]),_:1}),O(l(p,{label:"数据范围"},{default:t(()=>[c("div",Ve,[l(B,{ref_key:"deptTreeRef",ref:K,data:C.value,"show-checkbox":"","default-expand-all":"","node-key":"id",props:{label:"name",children:"children"}},null,8,["data"])])]),_:1},512),[[_e,s.dataScope==="2"]]),l(p,{label:"状态",prop:"status"},{default:t(()=>[l(de,{modelValue:s.status,"onUpdate:modelValue":e[3]||(e[3]=o=>s.status=o)},{default:t(()=>[l(F,{label:1},{default:t(()=>[...e[17]||(e[17]=[d("正常",-1)])]),_:1}),l(F,{label:0},{default:t(()=>[...e[18]||(e[18]=[d("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(E,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=o=>g.value=o),title:"分配菜单权限",width:"600px"},{footer:t(()=>[c("span",Ke,[l(r,{onClick:e[8]||(e[8]=o=>g.value=!1)},{default:t(()=>[...e[21]||(e[21]=[d("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:ee},{default:t(()=>[...e[22]||(e[22]=[d("确定",-1)])]),_:1})])]),default:t(()=>[l(q,{"label-width":"80px"},{default:t(()=>[l(p,{label:"角色名称"},{default:t(()=>[l(S,{modelValue:f.value.roleName,"onUpdate:modelValue":e[6]||(e[6]=o=>f.value.roleName=o),disabled:""},null,8,["modelValue"])]),_:1}),l(p,{label:"角色字符"},{default:t(()=>[l(S,{modelValue:f.value.roleKey,"onUpdate:modelValue":e[7]||(e[7]=o=>f.value.roleKey=o),disabled:""},null,8,["modelValue"])]),_:1}),l(p,{label:"菜单权限"},{default:t(()=>[c("div",Ce,[l(B,{ref_key:"menuTreeRef",ref:k,data:U.value,"show-checkbox":"","node-key":"id",props:{label:"name",children:"children"},"default-expand-all":""},null,8,["data"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Ie=ye(Se,[["__scopeId","data-v-23789ae3"]]);export{Ie as default};
