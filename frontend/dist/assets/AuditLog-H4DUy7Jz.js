import{r as m,a as te,a6 as oe,q as ne,c as T,d as _,b as e,w as l,e as u,X as se,o as w,f as o,h as E,F as ue,P as de,j as p,V as re,U as ie,a5 as F,a7 as pe,$ as ce,n as I,t as d,a8 as _e,p as fe,a0 as Y,a2 as z}from"./index-DOcvSAvK.js";import{s as D}from"./request-3uTHAmsp.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-ngrFHoWO.js";const ve={class:"page-container"},ge={class:"table-toolbar"},be={class:"pagination-container"},ye={class:"code-box"},we={class:"code-box"},he={key:0},xe={key:1,style:{color:"#F56C6C"}},Ve={class:"code-box error-text"},Te={class:"dialog-footer"},ke={__name:"AuditLog",setup(Ce){const M=[{value:1,label:"新增"},{value:2,label:"修改"},{value:3,label:"删除"},{value:4,label:"授权"},{value:5,label:"导出"},{value:6,label:"导入"},{value:7,label:"强退"},{value:8,label:"生成代码"},{value:9,label:"清空数据"}],k=m(!0),C=m([]),N=m(0),B=m([]),x=m(!1),v=m([]),S=m(null),n=m({}),j=te({queryParams:{pageNum:1,pageSize:10,title:void 0,operName:void 0,businessType:void 0,status:void 0}}),{queryParams:r}=oe(j),q=i=>{const a=M.find(h=>h.value===i);return a?a.label:"其他"},K=i=>{switch(i){case 1:return"success";case 2:return"warning";case 3:return"danger";case 4:return"primary";default:return"info"}},V=async()=>{k.value=!0;const i={...r.value};v.value&&v.value.length===2&&(i.beginTime=v.value[0],i.endTime=v.value[1]);try{const a=await D.get("/monitor/operlog/list",{params:i});B.value=a.data?.list||[],N.value=a.data?.total||0}catch{B.value=[],N.value=0}finally{k.value=!1}},b=()=>{r.value.pageNum=1,V()},A=()=>{v.value=[],S.value.resetFields(),b()},H=i=>{C.value=i.map(a=>a.id)},Q=i=>{x.value=!0,n.value=i},X=async i=>{const a=i.id||C.value;Y.confirm(`是否确认删除日志编号为"${a}"的数据项？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await D.delete(`/monitor/operlog/${a}`),z.success("删除成功"),V()}catch{}})},G=()=>{Y.confirm("是否确认清空所有操作日志数据项？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await D.delete("/monitor/operlog/clean"),z.success("清空成功"),V()}catch{}})},J=()=>{z.warning("演示环境暂不支持导出")};return ne(()=>{V()}),(i,a)=>{const h=u("el-input"),s=u("el-form-item"),U=u("el-option"),L=u("el-select"),O=u("el-date-picker"),y=u("el-icon"),g=u("el-button"),P=u("el-form"),R=u("el-card"),c=u("el-table-column"),$=u("el-tag"),W=u("el-table"),Z=u("el-pagination"),f=u("el-col"),ee=u("el-row"),le=u("el-dialog"),ae=se("loading");return w(),T("div",ve,[a[16]||(a[16]=_("div",{class:"header"},[_("h2",null,"操作日志")],-1)),e(R,{class:"search-card"},{default:l(()=>[e(P,{model:o(r),ref_key:"queryRef",ref:S,inline:!0,"label-width":"68px"},{default:l(()=>[e(s,{label:"系统模块",prop:"title"},{default:l(()=>[e(h,{modelValue:o(r).title,"onUpdate:modelValue":a[0]||(a[0]=t=>o(r).title=t),placeholder:"请输入系统模块",clearable:"",style:{width:"240px"},onKeyup:E(b,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"操作人员",prop:"operName"},{default:l(()=>[e(h,{modelValue:o(r).operName,"onUpdate:modelValue":a[1]||(a[1]=t=>o(r).operName=t),placeholder:"请输入操作人员",clearable:"",style:{width:"240px"},onKeyup:E(b,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"类型",prop:"businessType"},{default:l(()=>[e(L,{modelValue:o(r).businessType,"onUpdate:modelValue":a[2]||(a[2]=t=>o(r).businessType=t),placeholder:"操作类型",clearable:"",style:{width:"240px"}},{default:l(()=>[(w(),T(ue,null,de(M,t=>e(U,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"状态",prop:"status"},{default:l(()=>[e(L,{modelValue:o(r).status,"onUpdate:modelValue":a[3]||(a[3]=t=>o(r).status=t),placeholder:"操作状态",clearable:"",style:{width:"240px"}},{default:l(()=>[e(U,{label:"正常",value:0}),e(U,{label:"异常",value:1})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"操作时间",style:{width:"308px"}},{default:l(()=>[e(O,{modelValue:v.value,"onUpdate:modelValue":a[4]||(a[4]=t=>v.value=t),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),e(s,null,{default:l(()=>[e(g,{type:"primary",onClick:b},{default:l(()=>[e(y,null,{default:l(()=>[e(o(re))]),_:1}),a[9]||(a[9]=p(" 搜索 ",-1))]),_:1}),e(g,{onClick:A},{default:l(()=>[e(y,null,{default:l(()=>[e(o(ie))]),_:1}),a[10]||(a[10]=p(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),_("div",ge,[e(g,{type:"danger",plain:"",disabled:C.value.length===0,onClick:X},{default:l(()=>[e(y,null,{default:l(()=>[e(o(F))]),_:1}),a[11]||(a[11]=p(" 删除 ",-1))]),_:1},8,["disabled"]),e(g,{type:"danger",plain:"",onClick:G},{default:l(()=>[e(y,null,{default:l(()=>[e(o(F))]),_:1}),a[12]||(a[12]=p(" 清空 ",-1))]),_:1}),e(g,{type:"warning",plain:"",onClick:J},{default:l(()=>[e(y,null,{default:l(()=>[e(o(pe))]),_:1}),a[13]||(a[13]=p(" 导出 ",-1))]),_:1})]),e(R,{class:"table-card"},{default:l(()=>[ce((w(),I(W,{data:B.value,style:{width:"100%"},onSelectionChange:H},{default:l(()=>[e(c,{type:"selection",width:"55",align:"center"}),e(c,{label:"日志编号",align:"center",prop:"id",width:"100"}),e(c,{label:"系统模块",align:"center",prop:"title"}),e(c,{label:"操作类型",align:"center",prop:"businessType"},{default:l(t=>[e($,{type:K(t.row.businessType)},{default:l(()=>[p(d(q(t.row.businessType)),1)]),_:2},1032,["type"])]),_:1}),e(c,{label:"请求方式",align:"center",prop:"requestMethod"}),e(c,{label:"操作人员",align:"center",prop:"operName",width:"120"}),e(c,{label:"主机",align:"center",prop:"operIp",width:"130","show-overflow-tooltip":!0}),e(c,{label:"操作状态",align:"center",prop:"status"},{default:l(t=>[e($,{type:t.row.status===0?"success":"danger"},{default:l(()=>[p(d(t.row.status===0?"正常":"异常"),1)]),_:2},1032,["type"])]),_:1}),e(c,{label:"操作日期",align:"center",prop:"operTime",width:"180"},{default:l(t=>[_("span",null,d(t.row.operTime),1)]),_:1}),e(c,{label:"消耗时间",align:"center",prop:"costTime",width:"100"},{default:l(t=>[_("span",null,d(t.row.costTime)+"毫秒",1)]),_:1}),e(c,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(t=>[e(g,{link:"",type:"primary",onClick:Ne=>Q(t.row)},{default:l(()=>[e(y,null,{default:l(()=>[e(o(_e))]),_:1}),a[14]||(a[14]=p(" 详细 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,k.value]]),_("div",be,[e(Z,{"current-page":o(r).pageNum,"onUpdate:currentPage":a[5]||(a[5]=t=>o(r).pageNum=t),"page-size":o(r).pageSize,"onUpdate:pageSize":a[6]||(a[6]=t=>o(r).pageSize=t),"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:N.value,onSizeChange:b,onCurrentChange:b},null,8,["current-page","page-size","total"])])]),_:1}),e(le,{modelValue:x.value,"onUpdate:modelValue":a[8]||(a[8]=t=>x.value=t),title:"操作日志详细",width:"700px","append-to-body":""},{footer:l(()=>[_("div",Te,[e(g,{onClick:a[7]||(a[7]=t=>x.value=!1)},{default:l(()=>[...a[15]||(a[15]=[p("关 闭",-1)])]),_:1})])]),default:l(()=>[e(P,{model:n.value,"label-width":"100px"},{default:l(()=>[e(ee,null,{default:l(()=>[e(f,{span:12},{default:l(()=>[e(s,{label:"操作模块："},{default:l(()=>[p(d(n.value.title)+" / "+d(q(n.value.businessType)),1)]),_:1}),e(s,{label:"登录信息："},{default:l(()=>[p(d(n.value.operName)+" / "+d(n.value.operIp)+" / "+d(n.value.operLocation),1)]),_:1})]),_:1}),e(f,{span:12},{default:l(()=>[e(s,{label:"请求地址："},{default:l(()=>[p(d(n.value.operUrl),1)]),_:1}),e(s,{label:"请求方式："},{default:l(()=>[p(d(n.value.requestMethod),1)]),_:1})]),_:1}),e(f,{span:24},{default:l(()=>[e(s,{label:"操作方法："},{default:l(()=>[p(d(n.value.method),1)]),_:1})]),_:1}),e(f,{span:24},{default:l(()=>[e(s,{label:"请求参数："},{default:l(()=>[_("div",ye,d(n.value.operParam),1)]),_:1})]),_:1}),e(f,{span:24},{default:l(()=>[e(s,{label:"返回参数："},{default:l(()=>[_("div",we,d(n.value.jsonResult),1)]),_:1})]),_:1}),e(f,{span:12},{default:l(()=>[e(s,{label:"操作状态："},{default:l(()=>[n.value.status===0?(w(),T("div",he,"正常")):(w(),T("div",xe,"失败"))]),_:1})]),_:1}),e(f,{span:12},{default:l(()=>[e(s,{label:"消耗时间："},{default:l(()=>[p(d(n.value.costTime)+"毫秒",1)]),_:1})]),_:1}),e(f,{span:24},{default:l(()=>[n.value.status===1?(w(),I(s,{key:0,label:"异常信息："},{default:l(()=>[_("div",Ve,d(n.value.errorMsg),1)]),_:1})):fe("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Me=me(ke,[["__scopeId","data-v-a59965c7"]]);export{Me as default};
