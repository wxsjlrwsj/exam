import{r as v,a as O,q as _e,c as k,d as b,b as o,$ as ve,w as n,e as d,X as be,n as c,i as q,o as u,j as i,f as ge,S as Ve,F as S,P as I,t as U,p as M}from"./index-DOcvSAvK.js";import{i as Q}from"./http-CJ7Q9mKW.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-ngrFHoWO.js";const Fe={class:"question-bank-container"},Se={class:"page-header"},Ie={class:"pagination-container"},Ue={style:{width:"100%"}},Le={style:{"margin-top":"8px"}},Te={key:3,style:{width:"100%"}},xe={style:{display:"flex","justify-content":"flex-end",gap:"8px"}},Ee={__name:"QuestionBank",setup(Ae){const _=q("showMessage"),J=q("showConfirm"),L=v(!1),g=v(1),T=v(10),x=v(0),V=v([]),h=[{label:"单选题",value:"SINGLE"},{label:"多选题",value:"MULTI"},{label:"判断题",value:"TRUE_FALSE"},{label:"填空题",value:"FILL"},{label:"简答题",value:"SHORT"}],m=O({type:"",keyword:""}),H={1:"单选题",2:"多选题",3:"判断题",4:"填空题",5:"简答题"},K=a=>H[a]||"未知",C=async()=>{L.value=!0;try{const l=(await Q.get("/api/questions",{params:{page:g.value,size:T.value,typeCode:m.type||void 0,keyword:m.keyword||void 0}}))?.data||{},s=Array.isArray(l.list)?l.list:[];V.value=s,x.value=Number(l.total)||s.length}catch{V.value=[],x.value=0}finally{L.value=!1}},D=()=>{g.value=1,C()},X=()=>{m.type="",m.keyword="",D()},W=()=>{C()},Y=()=>{g.value=1,C()};_e(()=>{C()});const F=v(!1),e=O({typeCode:"SINGLE",content:"",subject:"Java",difficulty:1,options:[{key:"A",value:""},{key:"B",value:""}],answerSingle:"A",answerMulti:[],answerTrueFalse:!0,answerFill:[""],answerShort:"",knowledgePoints:"",useFile:!1,fileId:""}),E=a=>a==="SINGLE"||a==="MULTI"||a==="TRUE_FALSE",Z=()=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZ",l=e.options.map(s=>s.key);for(let s=0;s<a.length;s++){const r=a[s];if(!l.includes(r))return r}return String(e.options.length+1)},ee=()=>{e.options.push({key:Z(),value:""})},le=a=>{e.options.splice(a,1),e.options.find(l=>l.key===e.answerSingle)||(e.answerSingle=e.options.length?e.options[0].key:""),e.answerMulti=e.answerMulti.filter(l=>e.options.find(s=>s.key===l))},te=()=>{e.answerFill.push("")},oe=a=>{e.answerFill.splice(a,1)},j=()=>{e.typeCode="SINGLE",e.content="",e.subject="Java",e.difficulty=1,e.options=[{key:"A",value:""},{key:"B",value:""}],e.answerSingle="A",e.answerMulti=[],e.answerTrueFalse=!0,e.answerFill=[""],e.answerShort="",e.knowledgePoints="",e.useFile=!1,e.fileId=""},ne=()=>{j(),F.value=!0},ae=()=>{F.value=!1},se=()=>{if(!e.typeCode)return"请选择题型";if(!e.content||!e.content.trim())return"请输入题干";if(!e.subject||!e.subject.trim())return"请输入科目";if(E(e.typeCode)&&e.typeCode!=="TRUE_FALSE"){if(!Array.isArray(e.options)||e.options.length<2)return"请至少填写两个选项";for(const a of e.options)if(!a.value||!a.value.trim())return"选项内容不能为空";if(e.typeCode==="SINGLE"&&!e.options.map(l=>l.key).includes(e.answerSingle))return"请选择单选答案";if(e.typeCode==="MULTI"){if(!e.answerMulti||e.answerMulti.length===0)return"请至少选择一个多选答案";const a=e.options.map(l=>l.key);for(const l of e.answerMulti)if(!a.includes(l))return"选择了不存在的选项键"}}if(e.typeCode==="TRUE_FALSE"&&e.answerTrueFalse!==!0&&e.answerTrueFalse!==!1)return"请选择判断题答案";if(e.typeCode==="FILL"){if(!e.answerFill||e.answerFill.length===0)return"请至少填写一个填空答案";for(const a of e.answerFill)if(!a||!a.trim())return"填空答案不能为空"}return e.typeCode==="SHORT"&&(!e.answerShort||!e.answerShort.trim())?"请输入参考答案":e.useFile&&(!e.fileId||!e.fileId.trim())?"启用附件时必须填写文件ID":null},de=async()=>{const a=se();if(a){_(a,"warning");return}const l={typeCode:e.typeCode,content:e.content,options:E(e.typeCode)&&e.typeCode!=="TRUE_FALSE"?e.options.map(s=>({key:s.key,value:s.value})):null,answer:e.typeCode==="SINGLE"?[e.answerSingle]:e.typeCode==="MULTI"?e.answerMulti:e.typeCode==="TRUE_FALSE"?e.answerTrueFalse:e.typeCode==="FILL"?e.answerFill:e.answerShort,difficulty:e.difficulty,subject:e.subject,knowledgePoints:e.knowledgePoints,fileId:e.useFile&&e.fileId||null,useFile:e.useFile};try{const s=await Q.post("/api/questions",l);s&&s.code===200?(_("创建成功","success"),F.value=!1,j(),C()):_("创建失败","error")}catch{_("创建失败","error")}},ie=a=>{_(`编辑题目ID: ${a.id}`,"info")},ue=a=>{_(`预览题目ID: ${a.id}`,"info")},re=a=>{J(`确定要删除题目"${a.content.substring(0,20)}..."吗？`,"删除确认","warning").then(()=>{setTimeout(()=>{const l=V.value.findIndex(s=>s.id===a.id);l!==-1&&V.value.splice(l,1),_("删除成功","success")},500)}).catch(()=>{})};return(a,l)=>{const s=d("el-icon"),r=d("el-button"),N=d("el-option"),R=d("el-select"),p=d("el-form-item"),w=d("el-input"),P=d("el-form"),pe=d("el-card"),y=d("el-table-column"),z=d("el-rate"),$=d("el-table"),fe=d("el-pagination"),A=d("el-radio"),B=d("el-radio-group"),me=d("el-checkbox"),ye=d("el-checkbox-group"),ce=d("el-switch"),we=d("el-dialog"),ke=be("loading");return u(),k("div",Fe,[b("div",Se,[l[17]||(l[17]=b("h2",{class:"page-title"},"考题题库查看",-1)),o(r,{type:"primary",onClick:ne},{default:n(()=>[o(s,null,{default:n(()=>[o(ge(Ve))]),_:1}),l[16]||(l[16]=i("添加题目 ",-1))]),_:1})]),o(pe,{class:"filter-card"},{default:n(()=>[o(P,{inline:!0,model:m,class:"filter-form"},{default:n(()=>[o(p,{label:"题目类型"},{default:n(()=>[o(R,{modelValue:m.type,"onUpdate:modelValue":l[0]||(l[0]=t=>m.type=t),placeholder:"请选择题型",clearable:""},{default:n(()=>[(u(),k(S,null,I(h,t=>o(N,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),o(p,{label:"关键词"},{default:n(()=>[o(w,{modelValue:m.keyword,"onUpdate:modelValue":l[1]||(l[1]=t=>m.keyword=t),placeholder:"请输入关键词",clearable:""},null,8,["modelValue"])]),_:1}),o(p,null,{default:n(()=>[o(r,{type:"primary",onClick:D},{default:n(()=>[...l[18]||(l[18]=[i("查询",-1)])]),_:1}),o(r,{onClick:X},{default:n(()=>[...l[19]||(l[19]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),ve((u(),c($,{data:V.value,border:"",style:{width:"100%"}},{default:n(()=>[o(y,{prop:"id",label:"ID",width:"80"}),o(y,{prop:"typeId",label:"题型",width:"120"},{default:n(t=>[i(U(K(t.row.typeId)),1)]),_:1}),o(y,{prop:"content",label:"题目内容","show-overflow-tooltip":""}),o(y,{prop:"difficulty",label:"难度",width:"100"},{default:n(t=>[o(z,{modelValue:t.row.difficulty,"onUpdate:modelValue":f=>t.row.difficulty=f,disabled:"","text-color":"#ff9900"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(y,{prop:"createTime",label:"创建时间",width:"180"}),o(y,{label:"操作",width:"200",fixed:"right"},{default:n(t=>[o(r,{link:"",type:"primary",onClick:f=>ie(t.row)},{default:n(()=>[...l[20]||(l[20]=[i("编辑",-1)])]),_:1},8,["onClick"]),o(r,{link:"",type:"primary",onClick:f=>ue(t.row)},{default:n(()=>[...l[21]||(l[21]=[i("预览",-1)])]),_:1},8,["onClick"]),o(r,{link:"",type:"danger",onClick:f=>re(t.row)},{default:n(()=>[...l[22]||(l[22]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ke,L.value]]),b("div",Ie,[o(fe,{"current-page":g.value,"onUpdate:currentPage":l[2]||(l[2]=t=>g.value=t),"page-size":T.value,"onUpdate:pageSize":l[3]||(l[3]=t=>T.value=t),"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:x.value,onSizeChange:Y,onCurrentChange:W},null,8,["current-page","page-size","total"])]),o(we,{modelValue:F.value,"onUpdate:modelValue":l[15]||(l[15]=t=>F.value=t),title:"添加题目",width:"720px"},{footer:n(()=>[b("div",xe,[o(r,{onClick:ae},{default:n(()=>[...l[29]||(l[29]=[i("取消",-1)])]),_:1}),o(r,{type:"primary",onClick:de},{default:n(()=>[...l[30]||(l[30]=[i("提交",-1)])]),_:1})])]),default:n(()=>[o(P,{model:e,"label-width":"100px"},{default:n(()=>[o(p,{label:"题型"},{default:n(()=>[o(R,{modelValue:e.typeCode,"onUpdate:modelValue":l[4]||(l[4]=t=>e.typeCode=t),placeholder:"请选择题型"},{default:n(()=>[(u(),k(S,null,I(h,t=>o(N,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),o(p,{label:"题干"},{default:n(()=>[o(w,{modelValue:e.content,"onUpdate:modelValue":l[5]||(l[5]=t=>e.content=t),type:"textarea",rows:3,placeholder:"请输入题目内容"},null,8,["modelValue"])]),_:1}),o(p,{label:"科目"},{default:n(()=>[o(w,{modelValue:e.subject,"onUpdate:modelValue":l[6]||(l[6]=t=>e.subject=t),placeholder:"如：Java"},null,8,["modelValue"])]),_:1}),o(p,{label:"难度"},{default:n(()=>[o(z,{modelValue:e.difficulty,"onUpdate:modelValue":l[7]||(l[7]=t=>e.difficulty=t),max:5},null,8,["modelValue"])]),_:1}),E(e.typeCode)&&e.typeCode!=="TRUE_FALSE"?(u(),c(p,{key:0,label:"选项"},{default:n(()=>[b("div",Ue,[o($,{data:e.options,size:"small",style:{width:"100%"},border:""},{default:n(()=>[o(y,{label:"键",width:"80"},{default:n(t=>[i(U(t.row.key),1)]),_:1}),o(y,{label:"内容"},{default:n(t=>[o(w,{modelValue:t.row.value,"onUpdate:modelValue":f=>t.row.value=f,placeholder:"请输入选项内容"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(y,{label:"操作",width:"100"},{default:n(t=>[o(r,{link:"",type:"danger",onClick:f=>le(t.$index)},{default:n(()=>[...l[23]||(l[23]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),b("div",Le,[o(r,{onClick:ee},{default:n(()=>[...l[24]||(l[24]=[i("添加选项",-1)])]),_:1})])])]),_:1})):M("",!0),o(p,{label:"答案"},{default:n(()=>[e.typeCode==="SINGLE"?(u(),c(B,{key:0,modelValue:e.answerSingle,"onUpdate:modelValue":l[8]||(l[8]=t=>e.answerSingle=t)},{default:n(()=>[(u(!0),k(S,null,I(e.options,t=>(u(),c(A,{key:t.key,label:t.key},{default:n(()=>[i(U(t.key),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])):e.typeCode==="MULTI"?(u(),c(ye,{key:1,modelValue:e.answerMulti,"onUpdate:modelValue":l[9]||(l[9]=t=>e.answerMulti=t)},{default:n(()=>[(u(!0),k(S,null,I(e.options,t=>(u(),c(me,{key:t.key,label:t.key},{default:n(()=>[i(U(t.key),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])):e.typeCode==="TRUE_FALSE"?(u(),c(B,{key:2,modelValue:e.answerTrueFalse,"onUpdate:modelValue":l[10]||(l[10]=t=>e.answerTrueFalse=t)},{default:n(()=>[o(A,{label:!0},{default:n(()=>[...l[25]||(l[25]=[i("正确",-1)])]),_:1}),o(A,{label:!1},{default:n(()=>[...l[26]||(l[26]=[i("错误",-1)])]),_:1})]),_:1},8,["modelValue"])):e.typeCode==="FILL"?(u(),k("div",Te,[(u(!0),k(S,null,I(e.answerFill,(t,f)=>(u(),k("div",{key:f,style:{display:"flex",gap:"8px","margin-bottom":"8px"}},[o(w,{modelValue:e.answerFill[f],"onUpdate:modelValue":G=>e.answerFill[f]=G,placeholder:"填写空"},null,8,["modelValue","onUpdate:modelValue"]),o(r,{link:"",type:"danger",onClick:G=>oe(f)},{default:n(()=>[...l[27]||(l[27]=[i("删除",-1)])]),_:1},8,["onClick"])]))),128)),o(r,{onClick:te},{default:n(()=>[...l[28]||(l[28]=[i("添加空",-1)])]),_:1})])):e.typeCode==="SHORT"?(u(),c(w,{key:4,modelValue:e.answerShort,"onUpdate:modelValue":l[11]||(l[11]=t=>e.answerShort=t),type:"textarea",rows:3,placeholder:"请输入参考答案"},null,8,["modelValue"])):M("",!0)]),_:1}),o(p,{label:"知识点"},{default:n(()=>[o(w,{modelValue:e.knowledgePoints,"onUpdate:modelValue":l[12]||(l[12]=t=>e.knowledgePoints=t),placeholder:"如：JVM,集合"},null,8,["modelValue"])]),_:1}),o(p,{label:"使用附件"},{default:n(()=>[o(ce,{modelValue:e.useFile,"onUpdate:modelValue":l[13]||(l[13]=t=>e.useFile=t)},null,8,["modelValue"])]),_:1}),e.useFile?(u(),c(p,{key:1,label:"文件ID"},{default:n(()=>[o(w,{modelValue:e.fileId,"onUpdate:modelValue":l[14]||(l[14]=t=>e.fileId=t),placeholder:"文件ID"},null,8,["modelValue"])]),_:1})):M("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ne=Ce(Ee,[["__scopeId","data-v-dcd3fc01"]]);export{Ne as default};
