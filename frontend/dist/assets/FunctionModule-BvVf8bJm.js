import{a as S,r as x,k as ee,q as le,c as v,d as U,b as l,w as t,e as s,i as ae,o as u,j as f,f as F,S as te,U as oe,F as w,P as V,n as h,V as ne,t as j}from"./index-DOcvSAvK.js";import{s as M}from"./request-3uTHAmsp.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-ngrFHoWO.js";const se={class:"page-container"},re={class:"page-header"},ue={class:"header-actions"},ie={class:"pagination-container"},me={class:"dialog-footer"},pe={__name:"FunctionModule",setup(fe){const z=ae("showMessage"),r=S({keyword:"",category:"",status:""}),q=x([{label:"考试",value:"exam"},{label:"题库",value:"question"},{label:"成绩",value:"score"},{label:"统计分析",value:"analytics"},{label:"系统",value:"system"}]),$=x([{label:"管理员",value:"admin"},{label:"教师",value:"teacher"},{label:"学生",value:"student"}]),k=x([]),i=S({page:1,size:10,total:0}),o=S({visible:!1,mode:"create",saving:!1,form:{id:null,name:"",code:"",category:"",version:"1.0.0",enabled:!0,showInMenu:!0,routePath:"",allowedRoles:[],dependencies:[],description:""},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],code:[{required:!0,message:"请输入编码",trigger:"blur"}],category:[{required:!0,message:"请选择分类",trigger:"change"}],routePath:[{required:!0,message:"请输入路由路径",trigger:"blur"}]}}),I=x(null),E=ee(()=>k.value.map(n=>n.code)),L=n=>{const e=$.value.find(c=>c.value===n);return e?e.label:n},b=async()=>{try{const n=await M.get("/system/modules",{params:{page:i.page,size:i.size,keyword:r.keyword,category:r.category,status:r.status}}),e=n.data?.list||[],c=n.data?.total||0;k.value=e,i.total=c}catch{k.value=[],i.total=0}},N=()=>{const n=k.value.filter(e=>!e.enabled).map(e=>e.code);localStorage.setItem("disabledModules",n.join(",")),window.dispatchEvent(new Event("storage"))},D=()=>{i.page=1,b()},T=()=>{r.keyword="",r.category="",r.status="",D()},A=()=>{i.page=1,b()},G=()=>{b()},H=()=>{o.mode="create",Object.assign(o.form,{id:null,name:"",code:"",category:"",version:"1.0.0",enabled:!0,showInMenu:!0,routePath:"",allowedRoles:[],dependencies:[],description:""}),o.visible=!0},J=n=>{o.mode="edit",Object.assign(o.form,n),o.visible=!0},K=async n=>{try{await M.delete(`/system/modules/${n.id}`),z("删除成功","success"),b()}catch{}},Q=async(n,e)=>{try{await M.patch(`/system/modules/${n.id}/status`,{enabled:e}),n.enabled=e,N(),z("状态已更新 (请刷新页面查看左侧菜单变化)","success")}catch{n.enabled=!e}},W=async()=>{I.value&&await I.value.validate(async n=>{if(n){o.saving=!0;try{o.mode==="create"?await M.post("/system/modules",o.form):await M.put(`/system/modules/${o.form.id}`,o.form),z("保存成功","success"),o.visible=!1,b()}catch{}finally{o.saving=!1}}})};return le(()=>{b()}),(n,e)=>{const c=s("el-icon"),g=s("el-button"),y=s("el-input"),d=s("el-form-item"),_=s("el-option"),C=s("el-select"),O=s("el-form"),B=s("el-card"),m=s("el-table-column"),P=s("el-switch"),R=s("el-tag"),X=s("el-table"),Y=s("el-pagination"),Z=s("el-dialog");return u(),v("div",se,[U("div",re,[e[19]||(e[19]=U("h2",{class:"page-title"},"功能模块管理",-1)),U("div",ue,[l(g,{type:"primary",onClick:H},{default:t(()=>[l(c,null,{default:t(()=>[l(F(te))]),_:1}),e[17]||(e[17]=f("新建模块 ",-1))]),_:1}),l(g,{onClick:b},{default:t(()=>[l(c,null,{default:t(()=>[l(F(oe))]),_:1}),e[18]||(e[18]=f("刷新 ",-1))]),_:1})])]),l(B,{class:"filter-card"},{default:t(()=>[l(O,{inline:!0,model:r,class:"filter-form"},{default:t(()=>[l(d,{label:"关键词"},{default:t(()=>[l(y,{modelValue:r.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>r.keyword=a),placeholder:"模块名称/编码/路由",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"分类"},{default:t(()=>[l(C,{modelValue:r.category,"onUpdate:modelValue":e[1]||(e[1]=a=>r.category=a),placeholder:"选择分类",clearable:"",style:{width:"180px"}},{default:t(()=>[(u(!0),v(w,null,V(q.value,a=>(u(),h(_,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"状态"},{default:t(()=>[l(C,{modelValue:r.status,"onUpdate:modelValue":e[2]||(e[2]=a=>r.status=a),placeholder:"选择状态",clearable:"",style:{width:"160px"}},{default:t(()=>[l(_,{label:"启用",value:"enabled"}),l(_,{label:"停用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:t(()=>[l(g,{type:"primary",onClick:D},{default:t(()=>[l(c,null,{default:t(()=>[l(F(ne))]),_:1}),e[20]||(e[20]=f("搜索 ",-1))]),_:1}),l(g,{onClick:T},{default:t(()=>[...e[21]||(e[21]=[f("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(B,null,{default:t(()=>[l(X,{data:k.value,border:"",style:{width:"100%"}},{default:t(()=>[l(m,{prop:"name",label:"名称","min-width":"160"}),l(m,{prop:"code",label:"编码","min-width":"140"}),l(m,{prop:"category",label:"分类",width:"120"}),l(m,{prop:"version",label:"版本",width:"100"}),l(m,{label:"启用",width:"100"},{default:t(a=>[l(P,{modelValue:a.row.enabled,"onUpdate:modelValue":p=>a.row.enabled=p,onChange:p=>Q(a.row,p)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(m,{prop:"routePath",label:"路由路径","min-width":"180"}),l(m,{prop:"showInMenu",label:"菜单显示",width:"120"},{default:t(a=>[l(R,{type:a.row.showInMenu?"success":"info"},{default:t(()=>[f(j(a.row.showInMenu?"显示":"隐藏"),1)]),_:2},1032,["type"])]),_:1}),l(m,{label:"可见角色","min-width":"180"},{default:t(a=>[(u(!0),v(w,null,V(a.row.allowedRoles,p=>(u(),h(R,{key:p,type:"info",style:{"margin-right":"6px"}},{default:t(()=>[f(j(L(p)),1)]),_:2},1024))),128))]),_:1}),l(m,{label:"依赖模块","min-width":"200"},{default:t(a=>[(u(!0),v(w,null,V(a.row.dependencies,p=>(u(),h(R,{key:p,type:"warning",style:{"margin-right":"6px"}},{default:t(()=>[f(j(p),1)]),_:2},1024))),128))]),_:1}),l(m,{prop:"updatedAt",label:"更新时间",width:"180"}),l(m,{label:"操作",width:"180",fixed:"right"},{default:t(a=>[l(g,{link:"",type:"primary",onClick:p=>J(a.row)},{default:t(()=>[...e[22]||(e[22]=[f("编辑",-1)])]),_:1},8,["onClick"]),l(g,{link:"",type:"danger",onClick:p=>K(a.row)},{default:t(()=>[...e[23]||(e[23]=[f("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),U("div",ie,[l(Y,{"current-page":i.page,"onUpdate:currentPage":e[3]||(e[3]=a=>i.page=a),"page-size":i.size,"onUpdate:pageSize":e[4]||(e[4]=a=>i.size=a),total:i.total,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:A,onCurrentChange:G},null,8,["current-page","page-size","total"])])]),_:1}),l(Z,{modelValue:o.visible,"onUpdate:modelValue":e[16]||(e[16]=a=>o.visible=a),title:o.mode==="create"?"新建模块":"编辑模块",width:"700px"},{footer:t(()=>[U("span",me,[l(g,{onClick:e[15]||(e[15]=a=>o.visible=!1)},{default:t(()=>[...e[24]||(e[24]=[f("取消",-1)])]),_:1}),l(g,{type:"primary",loading:o.saving,onClick:W},{default:t(()=>[...e[25]||(e[25]=[f("保存",-1)])]),_:1},8,["loading"])])]),default:t(()=>[l(O,{model:o.form,rules:o.rules,ref_key:"dialogFormRef",ref:I,"label-width":"110px"},{default:t(()=>[l(d,{label:"名称",prop:"name"},{default:t(()=>[l(y,{modelValue:o.form.name,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.name=a),placeholder:"模块名称"},null,8,["modelValue"])]),_:1}),l(d,{label:"编码",prop:"code"},{default:t(()=>[l(y,{modelValue:o.form.code,"onUpdate:modelValue":e[6]||(e[6]=a=>o.form.code=a),placeholder:"唯一编码，如 exam_mgmt"},null,8,["modelValue"])]),_:1}),l(d,{label:"分类",prop:"category"},{default:t(()=>[l(C,{modelValue:o.form.category,"onUpdate:modelValue":e[7]||(e[7]=a=>o.form.category=a),placeholder:"选择分类"},{default:t(()=>[(u(!0),v(w,null,V(q.value,a=>(u(),h(_,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"版本",prop:"version"},{default:t(()=>[l(y,{modelValue:o.form.version,"onUpdate:modelValue":e[8]||(e[8]=a=>o.form.version=a),placeholder:"如 1.0.0"},null,8,["modelValue"])]),_:1}),l(d,{label:"路由路径",prop:"routePath"},{default:t(()=>[l(y,{modelValue:o.form.routePath,"onUpdate:modelValue":e[9]||(e[9]=a=>o.form.routePath=a),placeholder:"如 /dashboard/admin/function-module"},null,8,["modelValue"])]),_:1}),l(d,{label:"菜单显示",prop:"showInMenu"},{default:t(()=>[l(P,{modelValue:o.form.showInMenu,"onUpdate:modelValue":e[10]||(e[10]=a=>o.form.showInMenu=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"启用",prop:"enabled"},{default:t(()=>[l(P,{modelValue:o.form.enabled,"onUpdate:modelValue":e[11]||(e[11]=a=>o.form.enabled=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"可见角色",prop:"allowedRoles"},{default:t(()=>[l(C,{modelValue:o.form.allowedRoles,"onUpdate:modelValue":e[12]||(e[12]=a=>o.form.allowedRoles=a),multiple:"",placeholder:"选择角色"},{default:t(()=>[(u(!0),v(w,null,V($.value,a=>(u(),h(_,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"依赖模块",prop:"dependencies"},{default:t(()=>[l(C,{modelValue:o.form.dependencies,"onUpdate:modelValue":e[13]||(e[13]=a=>o.form.dependencies=a),multiple:"",filterable:"",placeholder:"选择依赖"},{default:t(()=>[(u(!0),v(w,null,V(E.value,a=>(u(),h(_,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"描述",prop:"description"},{default:t(()=>[l(y,{modelValue:o.form.description,"onUpdate:modelValue":e[14]||(e[14]=a=>o.form.description=a),type:"textarea",rows:3,placeholder:"模块说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}},ye=de(pe,[["__scopeId","data-v-9603d0f9"]]);export{ye as default};
