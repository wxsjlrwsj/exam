<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.chaoxingsystem.admin.monitor.OperLogMapper">

  <insert id="insert" parameterType="org.example.chaoxingsystem.admin.monitor.OperLog" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO sys_oper_log (title, business_type, method, request_method, oper_name, oper_url, oper_ip, oper_location, oper_param, json_result, status, error_msg, cost_time, oper_time)
    VALUES (#{title}, #{businessType}, #{method}, #{requestMethod}, #{operName}, #{operUrl}, #{operIp}, #{operLocation}, #{operParam}, #{jsonResult}, #{status}, #{errorMsg}, #{costTime}, NOW())
  </insert>

  <delete id="deleteByIds">
    DELETE FROM sys_oper_log WHERE id IN
    <foreach collection="ids" item="id" open="(" separator="," close=")">#{id}</foreach>
  </delete>

  <delete id="clean">TRUNCATE TABLE sys_oper_log</delete>

  <select id="count" resultType="long">
    SELECT COUNT(1) FROM sys_oper_log
    <where>
      <if test="title != null and title != ''">AND title LIKE CONCAT('%', #{title}, '%')</if>
      <if test="operName != null and operName != ''">AND oper_name LIKE CONCAT('%', #{operName}, '%')</if>
      <if test="businessType != null">AND business_type = #{businessType}</if>
      <if test="status != null">AND status = #{status}</if>
      <if test="beginTime != null and beginTime != ''">AND oper_time &gt;= #{beginTime}</if>
      <if test="endTime != null and endTime != ''">AND oper_time &lt;= #{endTime}</if>
    </where>
  </select>

  <select id="selectPage" resultType="org.example.chaoxingsystem.admin.monitor.OperLog">
    SELECT * FROM sys_oper_log
    <where>
      <if test="title != null and title != ''">AND title LIKE CONCAT('%', #{title}, '%')</if>
      <if test="operName != null and operName != ''">AND oper_name LIKE CONCAT('%', #{operName}, '%')</if>
      <if test="businessType != null">AND business_type = #{businessType}</if>
      <if test="status != null">AND status = #{status}</if>
      <if test="beginTime != null and beginTime != ''">AND oper_time &gt;= #{beginTime}</if>
      <if test="endTime != null and endTime != ''">AND oper_time &lt;= #{endTime}</if>
    </where>
    ORDER BY oper_time DESC
    LIMIT #{limit} OFFSET #{offset}
  </select>

</mapper>
