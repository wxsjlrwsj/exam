<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.chaoxingsystem.admin.perm.MenuMapper">

  <resultMap id="MenuMap" type="org.example.chaoxingsystem.admin.perm.Menu">
    <id property="id" column="id"/>
    <result property="parentId" column="parent_id"/>
    <result property="name" column="name"/>
    <result property="type" column="type"/>
    <result property="perms" column="perms"/>
    <result property="path" column="path"/>
    <result property="component" column="component"/>
    <result property="icon" column="icon"/>
    <result property="sortOrder" column="sort_order"/>
    <result property="visible" column="visible"/>
  </resultMap>

  <insert id="insert" parameterType="org.example.chaoxingsystem.admin.perm.Menu" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO sys_menu (parent_id, name, type, perms, path, component, icon, sort_order, visible)
    VALUES (#{parentId}, #{name}, #{type}, #{perms}, #{path}, #{component}, #{icon}, #{sortOrder}, #{visible})
  </insert>

  <update id="updateById" parameterType="org.example.chaoxingsystem.admin.perm.Menu">
    UPDATE sys_menu SET parent_id=#{parentId}, name=#{name}, type=#{type}, perms=#{perms}, path=#{path}, component=#{component}, icon=#{icon}, sort_order=#{sortOrder}, visible=#{visible}
    WHERE id=#{id}
  </update>

  <delete id="deleteById">DELETE FROM sys_menu WHERE id=#{id}</delete>

  <select id="selectById" resultMap="MenuMap">SELECT * FROM sys_menu WHERE id=#{id}</select>
  <select id="selectAll" resultMap="MenuMap">SELECT * FROM sys_menu ORDER BY sort_order ASC, id ASC</select>

  <select id="selectByRoleId" resultMap="MenuMap">
    SELECT m.* FROM sys_menu m
    JOIN sys_role_menu rm ON rm.menu_id = m.id
    WHERE rm.role_id = #{roleId}
    ORDER BY m.sort_order ASC, m.id ASC
  </select>

  <select id="selectRoleMenuIds" resultType="long">
    SELECT menu_id FROM sys_role_menu WHERE role_id = #{roleId}
  </select>

  <insert id="replaceRoleMenus">
    DELETE FROM sys_role_menu WHERE role_id = #{roleId};
    <foreach collection="menuIds" item="mid" separator=";">
      INSERT INTO sys_role_menu (role_id, menu_id) VALUES (#{roleId}, #{mid})
    </foreach>
  </insert>

</mapper>
